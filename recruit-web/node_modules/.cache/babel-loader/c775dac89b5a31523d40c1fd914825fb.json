{"remainingRequest":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\babel-loader\\lib\\index.js!E:\\graduateproject\\recruit\\recruit-web\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\graduateproject\\recruit\\recruit-web\\src\\lin\\util\\sse.js","dependencies":[{"path":"E:\\graduateproject\\recruit\\recruit-web\\src\\lin\\util\\sse.js","mtime":1682848612000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\babel.config.js","mtime":1682848612000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport Vue from 'vue';\n// import EventSourcePolyfill from 'event-source-polyfill'\nimport 'event-source-polyfill/src/eventsource';\nimport { getToken } from './cookie';\nimport store from '../../store';\nvar Sse = /*#__PURE__*/function () {\n  /**\n   * 需在vuex中确认有user对象后才能初始化，否则不连接服务器\n   * 注意： sse单独走自己的请求路线，不与axios重合，所以axios里面的配置在此处失效\n   * @param {string} url sse全路径\n   * @param {Array} events 当前用户可监听的路径\n   */\n  function Sse(url, events) {\n    var _this = this;\n    _classCallCheck(this, Sse);\n    _defineProperty(this, \"source\", null);\n    /* eslint-disable no-undef */\n    this.source = new EventSourcePolyfill(url, {\n      headers: {\n        Authorization: getToken('access_token')\n      }\n    });\n    this.open();\n    events.forEach(function (event) {\n      _this.addEventListener(event);\n    });\n  }\n  return _createClass(Sse, [{\n    key: \"open\",\n    value: function open() {\n      this.source.onopen = function (event) {\n        console.log('sse opened', event);\n      };\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      this.source.onerror = function (event) {\n        console.log('error', event);\n      };\n    }\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(eventName) {\n      this.source.addEventListener(eventName, function (event) {\n        // console.log('receive one message: ', event.data)\n        // console.log('receive one message: ', event.lastEventId)\n        store.commit('ADD_UNREAD_MESSAGE', {\n          data: event.data,\n          id: event.lastEventId\n        });\n        Vue.prototype.$notify({\n          title: '您有新的消息',\n          dangerouslyUseHTMLString: true,\n          message: \"<strong class=\\\"my-notify\\\">\".concat(JSON.parse(event.data).message, \"</strong>\")\n        });\n      });\n    }\n  }]);\n}();\nexport { Sse as default };",{"version":3,"names":["Vue","getToken","store","Sse","url","events","_this","_classCallCheck","_defineProperty","source","EventSourcePolyfill","headers","Authorization","open","forEach","event","addEventListener","_createClass","key","value","onopen","console","log","error","onerror","eventName","commit","data","id","lastEventId","prototype","$notify","title","dangerouslyUseHTMLString","message","concat","JSON","parse","default"],"sources":["E:/graduateproject/recruit/recruit-web/src/lin/util/sse.js"],"sourcesContent":["import Vue from 'vue'\n// import EventSourcePolyfill from 'event-source-polyfill'\nimport 'event-source-polyfill/src/eventsource'\nimport { getToken } from './cookie'\nimport store from '../../store'\n\nexport default class Sse {\n  source = null\n\n  /**\n   * 需在vuex中确认有user对象后才能初始化，否则不连接服务器\n   * 注意： sse单独走自己的请求路线，不与axios重合，所以axios里面的配置在此处失效\n   * @param {string} url sse全路径\n   * @param {Array} events 当前用户可监听的路径\n   */\n  constructor(url, events) {\n    /* eslint-disable no-undef */\n    this.source = new EventSourcePolyfill(url, {\n      headers: {\n        Authorization: getToken('access_token'),\n      },\n    })\n    this.open()\n\n    events.forEach(event => {\n      this.addEventListener(event)\n    })\n  }\n\n  open() {\n    this.source.onopen = event => {\n      console.log('sse opened', event)\n    }\n  }\n\n  error() {\n    this.source.onerror = event => {\n      console.log('error', event)\n    }\n  }\n\n  addEventListener(eventName) {\n    this.source.addEventListener(eventName, event => {\n      // console.log('receive one message: ', event.data)\n      // console.log('receive one message: ', event.lastEventId)\n      store.commit('ADD_UNREAD_MESSAGE', { data: event.data, id: event.lastEventId })\n      Vue.prototype.$notify({\n        title: '您有新的消息',\n        dangerouslyUseHTMLString: true,\n        message: `<strong class=\"my-notify\">${JSON.parse(event.data).message}</strong>`,\n      })\n    })\n  }\n}\n"],"mappings":";;;;;;;AAAA,OAAOA,GAAG,MAAM,KAAK;AACrB;AACA,OAAO,uCAAuC;AAC9C,SAASC,QAAQ,QAAQ,UAAU;AACnC,OAAOC,KAAK,MAAM,aAAa;AAAA,IAEVC,GAAG;EAGtB;AACF;AACA;AACA;AACA;AACA;EACE,SAAAA,IAAYC,GAAG,EAAEC,MAAM,EAAE;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAJ,GAAA;IAAAK,eAAA,iBARhB,IAAI;IASX;IACA,IAAI,CAACC,MAAM,GAAG,IAAIC,mBAAmB,CAACN,GAAG,EAAE;MACzCO,OAAO,EAAE;QACPC,aAAa,EAAEX,QAAQ,CAAC,cAAc;MACxC;IACF,CAAC,CAAC;IACF,IAAI,CAACY,IAAI,CAAC,CAAC;IAEXR,MAAM,CAACS,OAAO,CAAC,UAAAC,KAAK,EAAI;MACtBT,KAAI,CAACU,gBAAgB,CAACD,KAAK,CAAC;IAC9B,CAAC,CAAC;EACJ;EAAC,OAAAE,YAAA,CAAAd,GAAA;IAAAe,GAAA;IAAAC,KAAA,EAED,SAAAN,KAAA,EAAO;MACL,IAAI,CAACJ,MAAM,CAACW,MAAM,GAAG,UAAAL,KAAK,EAAI;QAC5BM,OAAO,CAACC,GAAG,CAAC,YAAY,EAAEP,KAAK,CAAC;MAClC,CAAC;IACH;EAAC;IAAAG,GAAA;IAAAC,KAAA,EAED,SAAAI,MAAA,EAAQ;MACN,IAAI,CAACd,MAAM,CAACe,OAAO,GAAG,UAAAT,KAAK,EAAI;QAC7BM,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEP,KAAK,CAAC;MAC7B,CAAC;IACH;EAAC;IAAAG,GAAA;IAAAC,KAAA,EAED,SAAAH,iBAAiBS,SAAS,EAAE;MAC1B,IAAI,CAAChB,MAAM,CAACO,gBAAgB,CAACS,SAAS,EAAE,UAAAV,KAAK,EAAI;QAC/C;QACA;QACAb,KAAK,CAACwB,MAAM,CAAC,oBAAoB,EAAE;UAAEC,IAAI,EAAEZ,KAAK,CAACY,IAAI;UAAEC,EAAE,EAAEb,KAAK,CAACc;QAAY,CAAC,CAAC;QAC/E7B,GAAG,CAAC8B,SAAS,CAACC,OAAO,CAAC;UACpBC,KAAK,EAAE,QAAQ;UACfC,wBAAwB,EAAE,IAAI;UAC9BC,OAAO,iCAAAC,MAAA,CAA+BC,IAAI,CAACC,KAAK,CAACtB,KAAK,CAACY,IAAI,CAAC,CAACO,OAAO;QACtE,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;EAAC;AAAA;AAAA,SA9CkB/B,GAAG,IAAAmC,OAAA","ignoreList":[]}]}