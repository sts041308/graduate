{"remainingRequest":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\graduateproject\\recruit\\recruit-web\\src\\view\\about\\msg.vue?vue&type=style&index=0&id=790200ae&lang=scss&scoped=true","dependencies":[{"path":"E:\\graduateproject\\recruit\\recruit-web\\src\\view\\about\\msg.vue","mtime":1682848612000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\graduateproject\\recruit\\recruit-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\t.ws-msg-form {\n\t\twidth: 800px;\n\t\theight: 700px;\n\t\timg {\n\t\t\tuser-select: none;\n\t\t\tpointer-events: none;\n\t\t\tborder: 1px solid #ffffff;\n\t\t}\n\t}\n\t.msg-content {\n\t\tmargin-left: 10px;\n\t\tdisplay: inline-block;\n\t\twidth: 100%;\n\t\theight: 80%;\n\t\tborder: 1px solid rgb(143, 141, 141);\n\t\tbackground-color: transparent !important;\n\t\tborder-radius: 5px;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t}\n\t.msg-title {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\ttext-align: center;\n\t\twidth: 100%;\n\t\tbackground-color: rgba(39, 39, 39, 0.219);\n\t\theight: 30px;\n\t\tline-height: 30px;\n\t}\n\t.msg-content .left {\n\t\tmargin-top: 30px;\n\t\twidth: 200px;\n\t\theight: 95%;\n\t\tborder-right: 1px solid rgb(143, 141, 141);\n\t\toverflow: auto;\n\t\toverflow-x: hidden;\n\t\tdisplay: inline-block;\n\t\t&::-webkit-scrollbar {\n\t\t\twidth: 5px;\n\t\t}\n\n\t\t&::-webkit-scrollbar-button {\n\t\t\tdisplay: none;\n\t\t}\n\t\t&::-webkit-scrollbar-thumb{\n\t\t\tbackground-color: rgba(124, 124, 124, 0.438);\n\t\t\tborder-radius: 5px;\n\t\t}\n\n\t\t.item {\n\t\t\tposition: relative;\n\t\t\theight: 78px;\n\t\t\tpadding-left: 20px;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tcursor: pointer;\n\t\t\tuser-select: none;\n\n\t\t\t&:hover {\n\t\t\t\tbackground-color: rgba(146, 146, 146, 0.3);\n\t\t\t}\n\n\t\t\t.icon {\n\t\t\t\twidth: 40px !important;\n\t\t\t\theight: 40px !important;\n\t\t\t\tborder-radius: 40px;\n\t\t\t}\n\t\t\tdiv {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop:20px;\n\t\t\t\tleft: 65px;\n\t\t\t\tfont-size: 14px;\n\t\t\t}\n\t\t\t.msg {\n\t\t\t\ttop: 45px;\n\t\t\t\tfont-size: 12px;\n\t\t\t\tcolor: rgb(114, 114, 114);\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\tmax-width: 130px;\n\t\t\t}\n\t\t\t.newTip,\n\t\t\t.online {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth:  10px;\n\t\t\t\theight: 10px;\n\t\t\t\tbackground: red;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 10px;\n\t\t\t\ttop: 20px;\n\t\t\t}\n\t\t\t.online {\n\t\t\t\tbackground-color: greenyellow;\n\t\t\t\ttop: 50px;\n\t\t\t\tleft: 20px;\n\t\t\t}\n\t\t\t.chat-time {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tfont-size: 13px;\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 5px;\n\t\t\t\ttop: 5px;\n\t\t\t\topacity: .7;\n\t\t\t}\n\t\t}\n\t}\n\t.msg-content .right {\n\t\tdisplay: inline-block !important;\n\t\theight: 94% !important;\n\t\twidth: 600px !important;\n\t\tposition: absolute !important;\n\t\tmargin-top: 30px;\n\t\t.form {\n\t\t\tposition: relative;\n\t\t\theight: 100%;\n\t\t\twidth: 100%;\n\t\t\t.content {\n\t\t\t\theight: 385px;\n\t\t\t\toverflow: auto;\n\t\t\t\tpadding: 0 10px;\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0.03) !important;\n\n\t\t\t\t&::-webkit-scrollbar{\n\t\t\t\t\toverflow-y: hidden;\n\t\t\t\t}\n\t\t\t\t.msg-item {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttransition: all .5s;\n\t\t\t\t\t>div img {\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\twidth:  35px;\n\t\t\t\t\t\theight: 35px;\n\t\t\t\t\t}\n\t\t\t\t\tspan {\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\tbackground: white;\n\t\t\t\t\t\tpadding: 10px 15px;\n\t\t\t\t\t\tfont-size: 15px;\n\t\t\t\t\t\tmax-width: 350px;\n\t\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\t\tword-break: break-word;\n\t\t\t\t\t}\n\n\t\t\t\t\t.tip {\n\t\t\t\t\t\twidth: 400px;\n\t\t\t\t\t\theight: 260px;\n\t\t\t\t\t\tborder-radius: 10px;\n\t\t\t\t\t\tbackground-color: white;\n\t\t\t\t\t\tmargin-left: 60px;\n\t\t\t\t\t}\n\t\t\t\t\t.sys,\n\t\t\t\t\t.target {\n\t\t\t\t\t\tfloat: left;\n\t\t\t\t\t\tmargin-left: 10px;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tspan {\n\t\t\t\t\t\t\tborder-radius: 20px;\n\t\t\t\t\t\t\tborder-top-left-radius: 0;\n\t\t\t\t\t\t\tmargin-left: 35px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t.this {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\tfloat: right;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tspan {\n\t\t\t\t\t\t\tfloat: right;\n\t\t\t\t\t\t\tbackground-color: rgb(128,185,242);\n\t\t\t\t\t\t\tmargin-right: 45px;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tborder-radius: 20px;\n\t\t\t\t\t\t\tborder-top-right-radius: 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\tright: 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t.birth-anim {\n\t\t\t\t\t\tanimation-name: birth;\n\t\t\t\t\t\tanimation-duration: .5s;\n\t\t\t\t\t\tanimation-iteration-count:1\n\t\t\t\t\t}\n\t\t\t\t\t// 样式穿透\n\t\t\t\t\t::v-deep .sys-msg {\n\t\t\t\t\t\t>* {\n\t\t\t\t\t\t\tmargin: 15px 0;\n\t\t\t\t\t\t\tcolor: #505050;\n\t\t\t\t\t\t\tfont-size: 15px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\th2 {\n\t\t\t\t\t\t\tfont-weight: 700;\n\t\t\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.info {\n\t\t\t\t\t\t\twidth: 400px;\n\t\t\t\t\t\t\tspan {\n\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\tmargin-bottom: 10px;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tspan:nth-child(1){\n\t\t\t\t\t\t\t\twidth: 100px !important;\n\t\t\t\t\t\t\t\topacity: .7;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t@keyframes birth {\n\t\t\t\t\t\t0%   {transform: translatey(50px);}\n\t\t\t\t\t\t100% {transform: translatey(0px);}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t.msg-footer {\n\t\t\tposition: relative;\n\t\t\tborder-top: 1px solid rgb(143, 141, 141);\n\t\t\ttextarea {\n\t\t\t\tresize: none;\n\t\t\t\toutline: none;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100px;\n\t\t\t\tborder: none;\n\t\t\t}\n\t\t\t.send {\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 10px;\n\t\t\t}\n\t\t}\n\t}\n\n\t.select-style {\n\t\tbackground-color: rgba(146, 146, 146, 0.3);\n\t}\n\n\t\n.rou-btn {\n\tmargin-top: 5px;\n    display: inline-block;\n    border: 1px solid cornflowerblue;\n    color: cornflowerblue;\n    border-radius: 5px;\n    padding: 3px 5px;\n\n\t&:hover{\n\t\tborder: 1px solid teal;\n\t\tcolor: teal;\n\t}\n}\n\n\n\n",{"version":3,"sources":["msg.vue"],"names":[],"mappings":";;AA0VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"msg.vue","sourceRoot":"src/view/about","sourcesContent":["<!-- 首页热门职位模块 -->\n<template>\n\t<div class=\"ws-msg-form\">\n\t\t<div class=\"msg-content\">\n\t\t\t<p class=\"msg-title\"  v-if=\"selectInfo.id==0\">在线聊天</p>\n\t\t\t<p class=\"msg-title\"  v-else>\n\t\t\t\t正在与 <b>{{selectInfo.name}}</b> 交流\n\t\t\t\t<span v-if=\"selectInfo.online\">(对方在线)</span>\n\t\t\t</p>\n\t\t\t<div class=\"left\">\n\t\t\t\t<div class=\"item\" v-for=\"(item,index) in chatInfo\" :key=\"index\" @click=\"clickChat(item)\"\n\t\t\t\t\t\t:class=\"{'select-style':item.id==selectInfo.id}\">\n\t\t\t\t\t<img class=\"icon\" :src=\"item.icon ? item.icon : defaultImg\">\n\t\t\t\t\t<!-- <img class=\"icon\" :src=\"defaultImg\" v-else> -->\n\t\t\t\t\t<div class=\"name\">{{item.name}}</div>\n\t\t\t\t\t<div class=\"msg\" v-if=\"item.type!='sys'\">\n\t\t\t\t\t\t<span v-if=\"item.msg && item.msg.length>0\">{{item.msg[item.msg.length-1].text}}</span>\n\t\t\t\t\t\t<span v-else>快来与对方进行沟通吧</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"msg\" v-else>{{item.header}}</div>\n\t\t\t\t\t<span :class=\"{'newTip':item.isRead==0}\"></span>\n\t\t\t\t\t<span :class=\"{'online':item.online}\"></span>\n\t\t\t\t\t<span class=\"chat-time\">{{item.msg[item.msg.length-1].time.split(\" \")[1]}}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"right\">\n\t\t\t\t<div class=\"form\">\n\t\t\t\t\t<div class=\"content\" v-if=\"selectInfo.id==-1 || selectInfo.id>0\">\t\n\t\t\t\t\t\t<div v-if=\"selectInfo.msg.length>0\">\n\t\t\t\t\t\t\t<div class=\"msg-item\" v-for=\"(item,index) in selectInfo.msg\" :key=\"index\">\n\t\t\t\t\t\t\t\t<div :class=\"item.type\">\n\t\t\t\t\t\t\t\t\t<img  :src=\"me.avatar ? me.avatar : defaultImg\" v-if=\"item.type=='this'\">\n\t\t\t\t\t\t\t\t\t<img  :src=\"selectInfo.icon\" v-else>\n\t\t\t\t\t\t\t\t\t<span v-html=\"item.text\"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"content\" v-else></div>\n\t\t\t\t\t\n\t\t\t\t\t<div class=\"msg-footer\">\n\t\t\t\t\t\t<textarea  v-model=\"inputRedis[selectInfo.id]\" maxlength=\"500\"></textarea>\n\t\t\t\t\t\t<div class=\"send\">\n\t\t\t\t\t\t\t<el-row>\n\t\t\t\t\t\t\t\t<span v-if=\"inputRedis[selectInfo.id]\">{{inputRedis[selectInfo.id].length}}/500</span>\n\t\t\t\t\t\t\t\t<span v-else>0/500</span>\n\t\t\t\t\t\t\t\t<el-button type=\"primary\" @click=\"sendMsg\">发送</el-button>\n\t\t\t\t\t\t\t</el-row>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t</div>\n\t\n</template>\n\n<script>\nimport { Application } from '@/model/application'\nimport Utils from '@/lin/util/util'\nimport store from '@/store';\nexport default{\n\tdata(){\n\t\treturn {\n\t\t\tme:null,\n\t\t\tinputRedis:{}, // 输入的内容缓存\n\t\t\tdefaultImg:require(\"@/assets/image/user/user.png\"),\n\t\t\tselectInfo:{\n\t\t\t\tid:0,\n\t\t\t\tmsg:[]\n\t\t\t},\n\t\t\tchatInfo:{},\n\t\t\ttarget_info:[],\n\t\t\ttoken_msg : {},\n\t\t\twsCtl:{\n\t\t\t\tallow:true,\n\t\t\t\ttimer:null\n\t\t\t},\n\t\t\thart:{\n\t\t\t\ttimer:5,  // 每隔一段时间监听一次在线客户端 /s\n\t\t\t\ttype:\"ping\",\n\t\t\t\ttimeObj:null,\n\t\t\t\tcheck:{} // 当客户端离线之后,第一次离线的加入对象内, 如果第二次还是离线,那么将目标用户标志为离线,避免重复闪烁\n\t\t\t}\n\t\t}\n\t},\n\tmethods:{\n\t\tclickChat(item){\n\t\t\t// console.log(\"item?\",item);\n\t\t\tthis.selectInfo=item;\n\t\t\tif(!item.isRead){\n\t\t\t\tthis.$ws.ws.send(JSON.stringify({type:\"state\",readID:this.selectInfo.id}))\n\t\t\t\titem.isRead = 1;\n\t\t\t}\n\t\t\tthis.moeScroll(10);\n\t\t},\n\t\tsendMsg(){\n\t\t\tif(!this.wsCtl.allow){return;}\n\t\t\tif(this.$ws.ws.readyState!=1){return this.$message.warning(\"暂时无法发送信息, 您与服务器的连接已断开.\")}\n\t\t\tif(!this.inputRedis[this.selectInfo.id]) return;\n\t\t\tlet inputMsg = this.inputRedis[this.selectInfo.id].slice(0,500); // 限制字数\n\t\t\tthis.inputRedis[this.selectInfo.id] = \"\"  // 清空输入框\n\n\t\t\tthis.selectInfo.msg.push({\"type\":\"this\",\"text\":inputMsg,time:new Date().toLocaleString()})\n\t\t\t// this.target_info.push({\"type\":\"target\",\"text\":inputMsg})\n\t\t\tthis.wsCtl.timer = setTimeout(() => {\n\t\t\t\tthis.wsCtl.allow = true;\n\t\t\t\tclearTimeout(this.wsCtl.timer);\n\t\t\t\tthis.wsCtl.timer = null;\n\t\t\t}, 1000);\n\t\t\ttry{\n\t\t\t\tthis.$ws.ws.send(JSON.stringify({\n\t\t\t\t\tself:{\n\t\t\t\t\t\tname:this.me.nickname,\n\t\t\t\t\t\ticon:JSON.stringify(this.me.avatar).length >100 ? \"null\": this.me.avatar,\n\t\t\t\t\t\tid:this.me.id\n\t\t\t\t\t},\n\t\t\t\t\ttarget:{\n\t\t\t\t\t\tid:this.selectInfo.id,\n\t\t\t\t\t\tname:this.selectInfo.name,\n\t\t\t\t\t\ticon:JSON.stringify(this.selectInfo.icon).length >100 ? \"null\": this.selectInfo.icon\n\t\t\t\t\t},\n\t\t\t\t\ttime:new Date().toLocaleString(),\n\t\t\t\t\ttype:\"alone\",\n\t\t\t\t\t// this_info:this.selectInfo.msg,\n\t\t\t\t\t// target_info:this.target_info,\n\t\t\t\t\tcontent:inputMsg,\n\t\t\t\t\trecvID:this.selectInfo.id\n\t\t\t\t}));\n\t\t\t\tthis.moeScroll();\n\t\t\t\t\n\t\t\t}catch(e){\n\t\t\t\tthis.selectInfo.msg.push({\"type\":\"this\",\"text\":\"(发送失败)\"+this.inputRedis[this.selectInfo.id]})\n\t\t\t\t// this.$ws.connect_sock(this.me.id)\n\t\t\t\t// this.$messge.warning(\"发送失败\")\n\t\t\t}\n\t\t},\n\t\trecvMsg(){\n\t\t\tif (this.$ws.ws){\n\t\t\t\t// 机器人默认在线,除非用户断开了与后台的连接\n\t\t\t\tthis.chatInfo[\"-1\"][\"online\"] = true\n\t\t\t\tlet msgInfo = {type:\"token\",_id:this.me.id}\n\t\t\t\tthis.$ws.ws.send(JSON.stringify(msgInfo))\n\t\t\t\t\n\t\t\t\tthis.$ws.ws.onmessage = async (res)=>{\n\t\t\t\t\tlet data = JSON.parse(res.data)\n\t\t\t\t\t// console.log(\"res:\",data); \n\t\t\t\t\t// 捕获系统消息并跳出\n\t\t\t\t\tif(data.type==\"system\"){\n\t\t\t\t\t\t// 将匹配的内容结果传递给api,\n\t\t\t\t\t\tlet info = await Application.getMsg(Utils.filterStr(data.content))\n\t\t\t\t\t\tthis.chatInfo[\"-1\"].msg.push({type:\"sys\",text:info.data,time:data.time});\n\t\t\t\t\t\tthis.moeScroll();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(data.type==\"token\"){\n\t\t\t\t\t\tconst info = {};\n\t\t\t\t\t\tfor(let i in data.content){\n\t\t\t\t\t\t\tlet cls = data.content[i].recvId == this.me.id ? \"target\" : \"this\";\n\t\t\t\t\t\t\t// 如果信息列表没有这个用户的数据\n\t\t\t\t\t\t\tlet keyID = data.content[i].sendId;\n\t\t\t\t\t\t\tif(info[keyID]==null){\n\t\t\t\t\t\t\t\tlet name = JSON.parse(data.content[i].self).name;\n\t\t\t\t\t\t\t\tlet icon = JSON.parse(data.content[i].self).icon;\n\t\t\t\t\t\t\t\t// 如果发送者的id是当前用户, 那么将写入数据的key修改为接收者的key\n\t\t\t\t\t\t\t\tif(parseInt(this.me.id) == parseInt(keyID)){\n\t\t\t\t\t\t\t\t\tkeyID = data.content[i].recvId;\n\t\t\t\t\t\t\t\t\tname = JSON.parse(data.content[i].target).name;\n\t\t\t\t\t\t\t\t\ticon = JSON.parse(data.content[i].target).icon;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tinfo[keyID] = keyID\n\t\t\t\t\t\t\t\tlet msg = [{type:cls , text:data.content[i].content,time:data.content[i].timestamp}]\n\t\t\t\t\t\t\t\tif(this.chatInfo[keyID] && this.chatInfo[keyID][\"msg\"]){\n\t\t\t\t\t\t\t\t\tthis.chatInfo[keyID][\"msg\"].push(msg[0]);\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\tthis.$set(this.chatInfo,keyID,this.packMsg(keyID,name,\"alone\",data.content[i].time,icon,msg,\"null\",0));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tthis.chatInfo[keyID][\"msg\"].push({type:cls , text:data.content[i].content, time:data.content[i].timestamp});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.chatInfo[keyID].isRead = data.readList.indexOf(\"^\"+keyID+\"&\") != -1 ? 0 : 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(data.ContactID !=-1){\n\t\t\t\t\t\t\tthis.selectInfo = this.chatInfo[data.ContactID];\n\t\t\t\t\t\t\tthis.selectInfo.isRead = 1;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tlet readList = data.readList.replace(/&/g,\"\").split(\"^\").filter(item =>item!=\"\")\n\t\t\t\t\t\t\tif(readList.length){\n\t\t\t\t\t\t\t\tthis.selectInfo = this.chatInfo[readList[0]];\n\t\t\t\t\t\t\t\tif(this.selectInfo && !this.selectInfo.isRead){\n\t\t\t\t\t\t\t\t\tthis.$ws.ws.send(JSON.stringify({type:\"state\",readID:this.selectInfo.id}))\n\t\t\t\t\t\t\t\t\tthis.selectInfo.isRead = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 心跳包\n\t\t\t\t\t\tthis.hartCheck(this.chatInfo)\n\t\t\t\t\t\tthis.hart.timeObj = setInterval(() => {\n\t\t\t\t\t\t\tthis.hartCheck(this.chatInfo)\n\t\t\t\t\t\t}, this.hart.timer*1000);\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.type==\"alone\"){\n\t\t\t\t\t\tif(this.chatInfo[data.self.id]){\n\t\t\t\t\t\t\tthis.chatInfo[data.self.id].msg.push({\"type\":\"target\",\"text\":data.content,time:data.time});\n\t\t\t\t\t\t\tthis.chatInfo[data.self.id].isRead = 0;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// 解决无法实时刷新dom\n\t\t\t\t\t\t\tthis.$set(this.chatInfo,data.self.id,{\"id\":data.self.id,\"name\":data.self.nickName,\"type\":\"user\",\"time\":data.time,\n\t\t\t\t\t\t\t\t\"icon\":data.self.icon,\"msg\":[{type:\"target\",text:data.content ,time:data.time}],\"head\":null,\"isRead\":0});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}else if  (data.type ===\"ping\"){\n\t\t\t\t\t\tthis.hart.check = {}\n\t\t\t\t\t\tif (data.content.length){\n\t\t\t\t\t\t\tlet info = data.content.split(\"|\")\n\t\t\t\t\t\t\tfor(let i =0;i< info.length-1;i++){\n\t\t\t\t\t\t\t\tthis.hart.check[info[i]] = true\n\t\t\t\t\t\t\t\tthis.$set(this.chatInfo[info[i]],\"online\",true)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.moeScroll();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmoeScroll(time=200){\n\t\t\tsetTimeout(() => {\n\t\t\t\tvar container = this.$el.querySelector(\".content\");\n\t\t\t\tcontainer.scrollTop = container.scrollHeight;\n\t\t\t}, time);\n\t\t},\n\t\tgetBrowserType() {\n\t\t\t// 获取浏览器 userAgent\n\t\t\tvar ua = navigator.userAgent\n\t\t\t// 是否为 Opera\n\t\t\tif (ua.indexOf('Opera') > -1) { return 'Opera' }\n\n\t\t\t// 是否为 IE\n\t\t\tvar isIE = (ua.indexOf('compatible') > -1) && (ua.indexOf('MSIE') > -1) && !isOpera\n\t\t\tvar isIE11 = (ua.indexOf('Trident') > -1) && (ua.indexOf(\"rv:11.0\") > -1)\n\t\t\t// 返回结果\n\t\t\tif (isIE11) { return 'IE11'\n\t\t\t} else if (isIE) {return \"IE\"}\n\t\t\t// 是否为 Edge\n\t\t\tif (ua.indexOf(\"Edg\") > -1) { return 'Edge' }\n\t\t\t// 是否为 Firefox\n\t\t\tif (ua.indexOf(\"Firefox\") > -1) { return 'Firefox' }\n\t\t\t// 是否为 Safari\n\t\t\tif ((ua.indexOf(\"Safari\") > -1) && (ua.indexOf(\"Chrome\") == -1)) { return \"Safari\" }\n\t\t\t// 是否为 Chrome\n\t\t\tif ((ua.indexOf(\"Chrome\") > -1) && (ua.indexOf(\"Safari\") > -1) && (ua.indexOf(\"Edge\") == -1)) { return 'Chrome' }\n\t\t\t// 是否为 UC\n\t\t\tif (ua.indexOf(\"UBrowser\") > -1) { return 'UC' }\n\t\t\t// 是否为 QQ\n\t\t\tif (ua.indexOf(\"QQBrowser\") > -1) { return 'QQ' }\n\t\t\t// 都不是\n\t\t\treturn \"未知设备\";\n\t\t},\n\t\t// 封装信息体\n\t\tpackMsg(id,name,type,time,icon,msg,header=null,isRead=0){\n\t\t\treturn {id:id,name:name,type:type,time:time,icon:icon ==null?this.defaultImg:icon,msg:msg,header:header,isRead:isRead};\n\t\t},\n\t\t// 心跳包检测\n\t\thartCheck(friends){\n\t\t\t// 如果与服务器的连接断开了\n\t\t\tif(this.$ws.ws.readyState === this.$ws.ws.CLOSED){\n\t\t\t\tthis.$message.warning(\"聊天服务器已断开\")\n\t\t\t\tclearInterval(this.hart.timeObj);\n\t\t\t\t// 将所有用户设为离线\n\t\t\t\tfor(let i in this.chatInfo){\n\t\t\t\t\tthis.chatInfo[i][\"online\"] = false\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\t}\n\t\n\t\t\tlet friends_list = \"\"\n\t\t\tfor (const iterator in friends) {\n\t\t\t\tif (parseInt(iterator) >0){\n\t\t\t\t\tif(!this.hart.check[iterator]){\n\t\t\t\t\t\tthis.$set(friends[iterator],\"online\",false)\n\t\t\t\t\t}\n\t\t\t\t\tfriends_list += iterator+\"|\"\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.$ws.ws.send(JSON.stringify({type:this.hart.type,friends_list}))\n\t\t}\n\t},\n\tasync mounted() {\n\t\t// this.$message.closeAll();\n\t\t// this.hartCheck(this.chatInfo);\n\t\tthis.me = store.getters.user;\n\t\tthis.token_msg = {\n\t\t\tid:this.me.id,\n\t\t\tname:this.me.name,\n\t\t\ticon:this.me.acatar,\n\t\t\tmsg:[],\n\t\t\theader:\"null\",\n\t\t\tisRead:1,\n\t\t\ttype:\"contact\",\n\t\t\ttime:new Date().toLocaleString()\n\t\t}\n\t\t// 默认有2个消息\n\t\tthis.chatInfo[\"-1\"] = this.packMsg(\"-1\",\"校企直聘智能机\",\"sys\",new Date().toLocaleString(),require(\"@/assets/image/user/Cat.png\")\n\t\t\t,[{\"type\":\"sys\",\"text\":\"\\\n\t\t\t\t<div class='sys-msg'>\\\n\t\t\t\t\t<h2>登录操作通知</h2>\\\n\t\t\t\t\t<div class='describe'>[\"+this.me.nickname+\"]欢迎回来校企招聘系统</div>\\\n\t\t\t\t\t<div class='info'>\\\n\t\t\t\t\t\t<div>\\\n\t\t\t\t\t\t\t<span>设备/平台</span>\\\n\t\t\t\t\t\t\t<span>\"+this.getBrowserType()+\"浏览器</span>\\\n\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t<div>\\\n\t\t\t\t\t\t\t<span>登录方式</span>\\\n\t\t\t\t\t\t\t<span>普通登录</span>\\\n\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t<div>\\\n\t\t\t\t\t\t\t<span>当前时间</span>\\\n\t\t\t\t\t\t\t<span>\"+new Date().toLocaleString()+\"</span>\\\n\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t<div>\\\n\t\t\t\t\t\t\t<span></span>\\\n\t\t\t\t\t\t\t<span>如有疑问,可以对我说噢!</span>\\\n\t\t\t\t\t\t</div>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div>\\\n\t\t\t\",time:new Date().toLocaleString()}],\"登录操作通知\",1)\n\n\t\tthis.chatInfo[\"1\"] = this.packMsg(\"1\",\"系统管理员\",\"alone\",new Date().toLocaleString(),require(\"@/assets/image/user/Cat.png\"),[{\"type\":\"target\",\"text\":\"反馈请留言\",time:new Date().toLocaleString()}],\"\",1)\n\t\tthis.selectInfo = this.chatInfo[\"-1\"];\n\t\tif(this.$ws.ws.readyState!=1)return;\n\t \tawait this.recvMsg();\n\t},\n\tbeforeDestroy() {\n\t\tclearTimeout(this.wsCtl.timer);\n\t\tclearInterval(this.hart.timeObj);\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\n\t.ws-msg-form {\n\t\twidth: 800px;\n\t\theight: 700px;\n\t\timg {\n\t\t\tuser-select: none;\n\t\t\tpointer-events: none;\n\t\t\tborder: 1px solid #ffffff;\n\t\t}\n\t}\n\t.msg-content {\n\t\tmargin-left: 10px;\n\t\tdisplay: inline-block;\n\t\twidth: 100%;\n\t\theight: 80%;\n\t\tborder: 1px solid rgb(143, 141, 141);\n\t\tbackground-color: transparent !important;\n\t\tborder-radius: 5px;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t}\n\t.msg-title {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\ttext-align: center;\n\t\twidth: 100%;\n\t\tbackground-color: rgba(39, 39, 39, 0.219);\n\t\theight: 30px;\n\t\tline-height: 30px;\n\t}\n\t.msg-content .left {\n\t\tmargin-top: 30px;\n\t\twidth: 200px;\n\t\theight: 95%;\n\t\tborder-right: 1px solid rgb(143, 141, 141);\n\t\toverflow: auto;\n\t\toverflow-x: hidden;\n\t\tdisplay: inline-block;\n\t\t&::-webkit-scrollbar {\n\t\t\twidth: 5px;\n\t\t}\n\n\t\t&::-webkit-scrollbar-button {\n\t\t\tdisplay: none;\n\t\t}\n\t\t&::-webkit-scrollbar-thumb{\n\t\t\tbackground-color: rgba(124, 124, 124, 0.438);\n\t\t\tborder-radius: 5px;\n\t\t}\n\n\t\t.item {\n\t\t\tposition: relative;\n\t\t\theight: 78px;\n\t\t\tpadding-left: 20px;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tcursor: pointer;\n\t\t\tuser-select: none;\n\n\t\t\t&:hover {\n\t\t\t\tbackground-color: rgba(146, 146, 146, 0.3);\n\t\t\t}\n\n\t\t\t.icon {\n\t\t\t\twidth: 40px !important;\n\t\t\t\theight: 40px !important;\n\t\t\t\tborder-radius: 40px;\n\t\t\t}\n\t\t\tdiv {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop:20px;\n\t\t\t\tleft: 65px;\n\t\t\t\tfont-size: 14px;\n\t\t\t}\n\t\t\t.msg {\n\t\t\t\ttop: 45px;\n\t\t\t\tfont-size: 12px;\n\t\t\t\tcolor: rgb(114, 114, 114);\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\tmax-width: 130px;\n\t\t\t}\n\t\t\t.newTip,\n\t\t\t.online {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth:  10px;\n\t\t\t\theight: 10px;\n\t\t\t\tbackground: red;\n\t\t\t\tborder-radius: 10px;\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 10px;\n\t\t\t\ttop: 20px;\n\t\t\t}\n\t\t\t.online {\n\t\t\t\tbackground-color: greenyellow;\n\t\t\t\ttop: 50px;\n\t\t\t\tleft: 20px;\n\t\t\t}\n\t\t\t.chat-time {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tfont-size: 13px;\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 5px;\n\t\t\t\ttop: 5px;\n\t\t\t\topacity: .7;\n\t\t\t}\n\t\t}\n\t}\n\t.msg-content .right {\n\t\tdisplay: inline-block !important;\n\t\theight: 94% !important;\n\t\twidth: 600px !important;\n\t\tposition: absolute !important;\n\t\tmargin-top: 30px;\n\t\t.form {\n\t\t\tposition: relative;\n\t\t\theight: 100%;\n\t\t\twidth: 100%;\n\t\t\t.content {\n\t\t\t\theight: 385px;\n\t\t\t\toverflow: auto;\n\t\t\t\tpadding: 0 10px;\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0.03) !important;\n\n\t\t\t\t&::-webkit-scrollbar{\n\t\t\t\t\toverflow-y: hidden;\n\t\t\t\t}\n\t\t\t\t.msg-item {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttransition: all .5s;\n\t\t\t\t\t>div img {\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\twidth:  35px;\n\t\t\t\t\t\theight: 35px;\n\t\t\t\t\t}\n\t\t\t\t\tspan {\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\tbackground: white;\n\t\t\t\t\t\tpadding: 10px 15px;\n\t\t\t\t\t\tfont-size: 15px;\n\t\t\t\t\t\tmax-width: 350px;\n\t\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\t\tword-break: break-word;\n\t\t\t\t\t}\n\n\t\t\t\t\t.tip {\n\t\t\t\t\t\twidth: 400px;\n\t\t\t\t\t\theight: 260px;\n\t\t\t\t\t\tborder-radius: 10px;\n\t\t\t\t\t\tbackground-color: white;\n\t\t\t\t\t\tmargin-left: 60px;\n\t\t\t\t\t}\n\t\t\t\t\t.sys,\n\t\t\t\t\t.target {\n\t\t\t\t\t\tfloat: left;\n\t\t\t\t\t\tmargin-left: 10px;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tspan {\n\t\t\t\t\t\t\tborder-radius: 20px;\n\t\t\t\t\t\t\tborder-top-left-radius: 0;\n\t\t\t\t\t\t\tmargin-left: 35px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t.this {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\tfloat: right;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tspan {\n\t\t\t\t\t\t\tfloat: right;\n\t\t\t\t\t\t\tbackground-color: rgb(128,185,242);\n\t\t\t\t\t\t\tmargin-right: 45px;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tborder-radius: 20px;\n\t\t\t\t\t\t\tborder-top-right-radius: 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\tright: 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t.birth-anim {\n\t\t\t\t\t\tanimation-name: birth;\n\t\t\t\t\t\tanimation-duration: .5s;\n\t\t\t\t\t\tanimation-iteration-count:1\n\t\t\t\t\t}\n\t\t\t\t\t// 样式穿透\n\t\t\t\t\t::v-deep .sys-msg {\n\t\t\t\t\t\t>* {\n\t\t\t\t\t\t\tmargin: 15px 0;\n\t\t\t\t\t\t\tcolor: #505050;\n\t\t\t\t\t\t\tfont-size: 15px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\th2 {\n\t\t\t\t\t\t\tfont-weight: 700;\n\t\t\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.info {\n\t\t\t\t\t\t\twidth: 400px;\n\t\t\t\t\t\t\tspan {\n\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\tmargin-bottom: 10px;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tspan:nth-child(1){\n\t\t\t\t\t\t\t\twidth: 100px !important;\n\t\t\t\t\t\t\t\topacity: .7;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t@keyframes birth {\n\t\t\t\t\t\t0%   {transform: translatey(50px);}\n\t\t\t\t\t\t100% {transform: translatey(0px);}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t.msg-footer {\n\t\t\tposition: relative;\n\t\t\tborder-top: 1px solid rgb(143, 141, 141);\n\t\t\ttextarea {\n\t\t\t\tresize: none;\n\t\t\t\toutline: none;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100px;\n\t\t\t\tborder: none;\n\t\t\t}\n\t\t\t.send {\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 10px;\n\t\t\t}\n\t\t}\n\t}\n\n\t.select-style {\n\t\tbackground-color: rgba(146, 146, 146, 0.3);\n\t}\n\n\t\n.rou-btn {\n\tmargin-top: 5px;\n    display: inline-block;\n    border: 1px solid cornflowerblue;\n    color: cornflowerblue;\n    border-radius: 5px;\n    padding: 3px 5px;\n\n\t&:hover{\n\t\tborder: 1px solid teal;\n\t\tcolor: teal;\n\t}\n}\n\n\n\n</style>"]}]}